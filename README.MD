# Backend API - E-commerce

## üöÄ Instalaci√≥n y Ejecuci√≥n

### 1. Instalar dependencias:
```bash
npm install
```

### 2. Configurar la base de datos en `db.js`:
```javascript
const pool = new Pool({
  host: "localhost",
  user: "postgres",
  password: "tu_password",
  database: "tu_database",
  port: 5432,
});
```

### 3. Configurar variables de entorno en `.env`:
```env
GMAIL_USER=tu_correo@gmail.com
GMAIL_APP_PASSWORD=tu_contrase√±a_de_aplicacion
```

### 4. Iniciar el servidor:
```bash
npm start
```

El servidor estar√° disponible en: `http://localhost:3000`

## ‚ö° Inicializaci√≥n Autom√°tica

Al iniciar el servidor por primera vez, el sistema autom√°ticamente:

1. ‚úÖ Crea todas las tablas necesarias en PostgreSQL
2. ‚úÖ Agrega el campo `es_super_admin` si no existe
3. ‚úÖ Crea el usuario super administrador (ID 1)
4. ‚úÖ Puebla la base de datos con productos de FakeStore API (solo si est√° vac√≠a)

### üîë Credenciales del Super Admin

- **Usuario:** `superadmin`
- **Contrase√±a:** `admin123`
- **Rol:** Administrador con privilegios especiales

**Importante:** Solo el super admin puede crear otros administradores.

## üóÑÔ∏è Scripts Disponibles

### Iniciar el servidor (con inicializaci√≥n autom√°tica)
```bash
npm start
```

### Ejecutar solo la inicializaci√≥n (sin iniciar servidor)
```bash
npm run init
```

### Ejecutar configuraci√≥n completa (legacy)
```bash
npm run setup
```

Todos estos scripts realizan la misma inicializaci√≥n del sistema.

## üìä Base de Datos

El sistema crea autom√°ticamente las siguientes tablas en PostgreSQL:

- **usuarios** - Gesti√≥n de usuarios y autenticaci√≥n
- **pedidos** - Registro de pedidos
- **pedido_producto** - Productos asociados a pedidos
- **token** - Tokens de recuperaci√≥n de contrase√±a

## üìö Documentaci√≥n

- **API Endpoints:** Consulta `API_ENDPOINTS.md` para ver todos los endpoints disponibles
- **Inicializaci√≥n:** Consulta `INICIALIZACION.md` para detalles sobre el sistema de inicializaci√≥n autom√°tica
- **Permisos de Admin:** Consulta `PERMISOS_ADMIN.md` para entender el sistema de permisos y acceso por administrador

## üîë Endpoints Principales

### Usuarios
- `POST /api/usuarios/register` - Registrar usuario
- `POST /api/usuarios/login` - Iniciar sesi√≥n
- `GET /api/usuarios` - Listar usuarios
- `GET /api/usuarios/:id` - Obtener usuario
- `PUT /api/usuarios/:id` - Actualizar usuario
- `DELETE /api/usuarios/:id` - Eliminar usuario

### Pedidos
- `POST /api/pedidos` - Crear pedido
- `GET /api/pedidos` - Listar pedidos
- `GET /api/pedidos/:id` - Obtener pedido
- `GET /api/pedidos/usuario/:id_usuario` - Pedidos por usuario
- `PUT /api/pedidos/:id` - Actualizar pedido
- `DELETE /api/pedidos/:id` - Eliminar pedido

### Pedido Productos
- `POST /api/pedido-productos` - Agregar producto a pedido
- `GET /api/pedido-productos/pedido/:id_pedido` - Productos de un pedido
- `PUT /api/pedido-productos/:id` - Actualizar producto
- `DELETE /api/pedido-productos/:id` - Eliminar producto

### Tokens
- `GET /api/tokens` - Listar tokens
- `DELETE /api/tokens/clean/expired` - Limpiar tokens expirados

## üõ†Ô∏è Tecnolog√≠as

- Node.js + Express
- PostgreSQL
- bcrypt (encriptaci√≥n de contrase√±as)
- nodemailer (env√≠o de correos)
- cors (manejo de CORS)

## üß™ Pruebas con Thunder Client

Base URL: `http://localhost:3000/api`

Ejemplo de registro:
```json
POST /api/usuarios/register
{
  "nombre": "Juan",
  "apellido": "P√©rez",
  "correo": "juan@example.com",
  "telefono": "1234567890",
  "direccion": "Calle 123",
  "rol": "cliente",
  "usuario": "juanperez",
  "contrasena": "password123"
}
```
